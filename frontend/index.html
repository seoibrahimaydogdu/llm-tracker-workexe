<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Visibility Analytics - Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4f46e5;
            --secondary-color: #10b981;
            --success-color: #22c55e;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
            --border-color: #e5e7eb;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --sidebar-width: 260px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light-color);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .dashboard-container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            border-right: 1px solid var(--border-color);
            padding: 24px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            left: 0;
            top: 0;
            z-index: 1000;
        }

        .logo {
            padding: 0 24px 24px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 24px;
        }

        .logo h1 {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            margin-bottom: 4px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            transition: all 0.2s;
        }

        .nav-link:hover,
        .nav-link.active {
            background: #f3f4f6;
            color: var(--primary-color);
        }

        .nav-link.active {
            border-right: 3px solid var(--primary-color);
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 16px 24px;
            min-height: 100vh;
            width: calc(100% - var(--sidebar-width));
            box-sizing: border-box;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-top: 8px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: white;
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background: #4338ca;
        }

        .btn-secondary {
            background: var(--text-secondary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .stat-icon.primary { background: var(--primary-color); }
        .stat-icon.success { background: var(--success-color); }
        .stat-icon.warning { background: var(--warning-color); }
        .stat-icon.info { background: var(--info-color); }

        .stat-content h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-content p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .stat-change {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .stat-change.positive { color: var(--success-color); }
        .stat-change.negative { color: var(--danger-color); }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 24px;
            margin-bottom: 32px;
        }

        /* Visibility Chart */
        .chart-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
        }

        .chart-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-badge {
            background: #dbeafe;
            color: var(--info-color);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .visibility-score {
            text-align: center;
            margin-bottom: 24px;
        }

        .visibility-score h2 {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
        }

        .visibility-score p {
            color: var(--text-secondary);
        }

        /* Rankings Table */
        .ranking-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
        }

        .ranking-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
        }

        .ranking-table th {
            text-align: left;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .ranking-table td {
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .brand-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .brand-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            font-weight: 600;
        }

        .score-badge {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .score-badge.excellent { background: #dcfce7; color: var(--success-color); }
        .score-badge.good { background: #fef3c7; color: var(--warning-color); }
        .score-badge.average { background: #fee2e2; color: var(--danger-color); }

        /* Analysis Tools */
        .tools-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .tool-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
        }

        .tool-header {
            margin-bottom: 20px;
        }

        .tool-header h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .tool-header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-control.textarea {
            min-height: 80px;
            resize: vertical;
        }

        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .tag {
            background: var(--primary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .tag .remove {
            cursor: pointer;
            opacity: 0.7;
        }

        .tag .remove:hover {
            opacity: 1;
        }

        /* Results */
        .results-section {
            margin-top: 32px;
            display: none;
        }

        .results-section.show {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 24px;
        }

        .result-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
        }

        .result-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 16px;
        }

        .result-title {
            font-size: 16px;
            font-weight: 600;
        }

        .result-status {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .result-status.mentioned {
            background: #dcfce7;
            color: var(--success-color);
        }

        .result-status.not-mentioned {
            background: #fee2e2;
            color: var(--danger-color);
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .detail-item {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .detail-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .detail-value {
            font-weight: 500;
        }

        .ai-analysis {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .ai-analysis h4 {
            color: var(--primary-color);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-analysis pre {
            white-space: pre-wrap;
            font-family: inherit;
            font-size: 14px;
            line-height: 1.5;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f4f6;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 0;
            border: none;
            border-radius: 16px;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-50px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 24px 0;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 24px;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--primary-color);
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            padding: 0 8px;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .modal-close:hover {
            color: #ef4444;
            background: #fee2e2;
        }

        .modal-body {
            padding: 0 24px 24px;
            max-height: 70vh;
            overflow-y: auto;
        }

        /* Form Styles */
        .test-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-input, .form-textarea {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .form-textarea {
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }

        .form-hint {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: -4px;
        }

        .test-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .radio-option:hover {
            border-color: var(--primary-color);
            background: #f8fafc;
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-custom {
            width: 20px;
            height: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 50%;
            position: relative;
            transition: all 0.2s;
        }

        .radio-option input[type="radio"]:checked + .radio-custom {
            border-color: var(--primary-color);
            background: var(--primary-color);
        }

        .radio-option input[type="radio"]:checked + .radio-custom::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e5e7eb;
        }

        /* Loading Styles */
        .test-loading {
            text-align: center;
            padding: 40px 20px;
        }

        .loading-content {
            max-width: 400px;
            margin: 0 auto;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f4f6;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 24px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f3f4f6;
            border-radius: 4px;
            overflow: hidden;
            margin: 24px 0 8px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .progress-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* Results Styles */
        .test-results {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
        }

        .results-header h4 {
            margin: 0;
            color: var(--primary-color);
        }

        /* Project Selection Styles */
        .project-selection {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .project-selection h3 {
            margin: 0 0 20px 0;
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .project-filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .filter-group select {
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            background: white;
            color: var(--text-primary);
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .filter-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .filter-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-outline {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-outline:hover {
            background: var(--text-secondary);
            color: white;
            border-color: var(--text-secondary);
        }

        .btn-info {
            background: #0ea5e9;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-info:hover {
            background: #0284c7;
            transform: translateY(-1px);
        }

        /* Test Results Additional Styles */
        .result-stats {
            display: flex;
            gap: 24px;
            margin-top: 16px;
        }

        /* Prompt Info Styles */
        .prompt-info {
            margin-bottom: 20px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .prompt-info h5 {
            margin: 0 0 12px 0;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .prompt-item {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            background: white;
        }

        .prompt-item.success {
            border-color: var(--success-color);
            background: #f0fdf4;
        }

        .prompt-item.danger {
            border-color: var(--danger-color);
            background: #fef2f2;
        }

        .prompt-item.info {
            border-color: var(--primary-color);
            background: #f0f9ff;
        }

        .prompt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .prompt-number {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 12px;
        }

        .prompt-status {
            font-weight: 600;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .prompt-text {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .prompt-meta {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Detailed Test Results Styles */
        .detailed-test-results {
            margin-top: 24px;
            padding: 20px;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }

        .detailed-test-results h4 {
            margin: 0 0 16px 0;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detailed-test-item {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            background: #f8fafc;
        }

        .detailed-test-item.success {
            border-color: var(--success-color);
            background: #f0fdf4;
        }

        .detailed-test-item.danger {
            border-color: var(--danger-color);
            background: #fef2f2;
        }

        .detailed-test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }

        .test-number {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .test-status {
            font-weight: 600;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .test-prompt-detail {
            margin-bottom: 12px;
            font-size: 14px;
            line-height: 1.5;
        }

        .test-response-detail {
            margin-bottom: 16px;
        }

        .test-response-detail strong {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .response-content {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            font-size: 13px;
            line-height: 1.5;
            max-height: 200px;
            overflow-y: auto;
            color: var(--text-secondary);
        }

        .test-metrics {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .metric {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
            padding: 4px 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
        }

        .metric i {
            color: var(--primary-color);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            display: block;
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .test-details {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .test-item {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            background: #f8fafc;
        }

        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .test-number {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .test-status {
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .test-status.success {
            background: #dcfce7;
            color: var(--success-color);
        }

        .test-status.danger {
            background: #fee2e2;
            color: var(--danger-color);
        }

        .test-prompt {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .test-meta {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* Test Results Section */
        .test-results-section {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-top: 24px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .test-summary-grid {
            display: grid;
            gap: 16px;
        }

        .test-summary-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .summary-header h4 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .summary-content p {
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-size: 14px;
        }

        .summary-stats {
            display: flex;
            gap: 24px;
        }

        .stat {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-color);
        }

        /* Info Grid */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .info-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .info-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }

        .info-content h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .info-content p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .quick-test-section {
            text-align: center;
            padding: 24px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .quick-test-section h4 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .quick-test-section p {
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        /* Recent Tests */
        .recent-tests-section {
            margin-top: 32px;
        }

        .recent-tests-section h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .recent-tests-grid {
            display: grid;
            gap: 16px;
        }

        .test-history-item {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.2s;
            cursor: pointer;
        }

        .test-history-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.1);
            transform: translateY(-2px);
        }

        .test-history-item:active {
            transform: translateY(0);
        }

        .test-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .test-history-header h4 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-color);
        }

        .test-date {
            font-size: 12px;
            color: var(--text-muted);
        }

        .test-history-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 8px;
        }

        .test-history-stats .stat {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: var(--text-muted);
            padding: 4px 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
        }

        .test-history-stats .stat i {
            color: var(--primary-color);
        }

        .test-history-prompts {
            font-size: 11px;
            color: var(--text-muted);
            line-height: 1.4;
        }

        /* Insights Grid */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .insight-card {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
        }

        .insight-header {
            margin-bottom: 16px;
        }

        .insight-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .insight-content {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.5;
        }

        .detailed-insights {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
        }

        .detailed-insights h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .insight-placeholder {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .insight-placeholder p {
            margin: 0;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .tools-section {
                grid-template-columns: 1fr;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .insights-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 10px auto;
            }
            
            .modal-body {
                max-height: 80vh;
            }
            
            .form-actions {
                flex-direction: column;
            }
        }

        /* Industry Ranking Styles */
        .industry-ranking-box {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 8px #e0e7ef;
  padding: 20px;
  margin-bottom: 24px;
}

.industry-ranking-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
  font-size: 16px;
}

.industry-ranking-period {
  background: #e0e7ef;
  color: #4f46e5;
  border-radius: 8px;
  padding: 2px 10px;
  font-size: 13px;
}

.industry-ranking-table {
  width: 100%;
  border-collapse: collapse;
}

.industry-ranking-table th, .industry-ranking-table td {
  padding: 8px 12px;
  text-align: center;
}

.industry-ranking-table th {
  background: #f8fafc;
  font-weight: 600;
}

.industry-ranking-table tr:nth-child(even) {
  background: #f4f6fa;
}
.industry-ranking-table .your-brand {
  background: #eef2ff !important;
  color: #4f46e5;
  font-weight: bold;
}

/* Prompt Analizi sekmesi için üst boşluğu azalt */
#real-api-test-tab.tab-content {
    padding-top: 24px !important;
    margin-top: 0 !important;
}
#real-api-test-tab .tool-card {
    margin-top: 0 !important;
    padding-top: 16px !important;
}

/* Prompt Analizi tab içeriği için stil güncellemeleri */
#real-api-test-tab {
    padding: 16px 24px !important; /* 24px 32px'den düşürüldü */
    height: calc(100vh - 60px); /* 80px'den düşürüldü */
    overflow-y: auto;
}

#real-api-test-tab .header {
    margin-bottom: 16px; /* 32px'den düşürüldü */
}

#real-api-test-tab .tool-card {
    padding: 24px; /* 32px'den düşürüldü */
    max-width: 800px;
    margin: 0 auto;
    margin-top: 0 !important;
    padding-top: 16px !important;
}

#real-api-test-tab .tool-header {
    margin-bottom: 16px; /* 32px'den düşürüldü */
}

#real-api-test-tab .form-group {
    margin-bottom: 16px; /* 24px'den düşürüldü */
}

#real-api-test-tab .form-actions {
    padding-top: 16px; /* 24px'den düşürüldü */
    margin-top: 16px; /* Yeni eklendi */
}

/* Form elemanları için padding düzenlemeleri */
#real-api-test-tab .form-input,
#real-api-test-tab .form-textarea {
    padding: 8px 12px; /* 12px'den düşürüldü */
}
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-chart-line"></i> AI Analytics</h1>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-tab="dashboard">
                        <div class="nav-icon"><i class="fas fa-chart-line"></i></div>
                        Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-tab="real-api-test">
                        <div class="nav-icon"><i class="fas fa-comment-dots"></i></div>
                        Prompt Analizi
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-tab="insights">
                        <div class="nav-icon"><i class="fas fa-lightbulb"></i></div>
                        Insights
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-tab="sources">
                        <div class="nav-icon"><i class="fas fa-link"></i></div>
                        Sources
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <div class="header dashboard-header">
                    <h1>Dashboard</h1>
                    <p>AI görünürlük analizi genel bakış</p>
                </div>

                <!-- Project Selection -->
                <div class="project-selection">
                    <h3><i class="fas fa-filter"></i> Proje Filtreleme</h3>
                    <div class="project-filters">
                        <div class="filter-group">
                            <label>Proje Seçin:</label>
                            <select id="dashboard-project-filter" onchange="filterDashboardByProject()">
                                <option value="">Tüm Projeler</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Prompt Filtresi:</label>
                            <select id="dashboard-prompt-filter" onchange="filterDashboardByPrompt()">
                                <option value="">Tüm Promptlar</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Tarih Aralığı:</label>
                            <select id="dashboard-date-filter" onchange="filterDashboardByDate()">
                                <option value="">Tüm Tarihler</option>
                                <option value="today">Bugün</option>
                                <option value="week">Bu Hafta</option>
                                <option value="month">Bu Ay</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button class="btn btn-outline" onclick="clearDashboardFilters()">
                            <i class="fas fa-times"></i> Filtreleri Temizle
                        </button>
                        <button class="btn btn-info" onclick="refreshDashboardData()">
                            <i class="fas fa-sync"></i> Verileri Yenile
                        </button>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card" id="visibility-card">
                        <div class="stat-icon primary">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="visibility-score">17%</h3>
                            <p class="stat-title">AI Visibility Score</p>
                            <p class="stat-subtitle">Genel</p>
                            <p class="stat-description">AI modellerinde görünürlük skoru</p>
                        </div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +2.3%
                        </div>
                    </div>

                    <div class="stat-card" id="mentions-card">
                        <div class="stat-icon success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-mentions">127</h3>
                            <p class="stat-title">Total Mentions</p>
                            <p class="stat-subtitle">Genel</p>
                            <p class="stat-description">Toplam mention sayısı</p>
                        </div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +12.5%
                        </div>
                    </div>

                    <div class="stat-card" id="position-card">
                        <div class="stat-icon warning">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="avg-position">3.2</h3>
                            <p class="stat-title">Avg. Position</p>
                            <p class="stat-subtitle">Genel</p>
                            <p class="stat-description">Ortalama sıralama pozisyonu</p>
                        </div>
                        <div class="stat-change negative">
                            <i class="fas fa-arrow-down"></i> -0.8
                        </div>
                    </div>

                    <div class="stat-card" id="models-card">
                        <div class="stat-icon info">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="ai-models">8</h3>
                            <p class="stat-title">AI Models Tracked</p>
                            <p class="stat-subtitle">Genel</p>
                            <p class="stat-description">Takip edilen AI model sayısı</p>
                        </div>
                        <div class="stat-change positive">
                            <i class="fas fa-arrow-up"></i> +2
                        </div>
                    </div>
                </div>

                <!-- Main Grid -->
                <div class="main-grid">
                    <!-- Visibility Chart -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3 class="chart-title">AI Visibility Trend</h3>
                            <span class="chart-badge">New</span>
                        </div>
                        
                        <div class="visibility-score">
                            <h2 id="current-visibility-score">17%</h2>
                            <p>Current Visibility Score</p>
                        </div>
                        
                        <canvas id="visibilityChart" width="400" height="200"></canvas>
                    </div>

                    <!-- Industry Ranking -->
                    <div class="ranking-card">
                        <div class="ranking-header">
                            <h3 class="chart-title">Industry Ranking</h3>
                            <span class="chart-badge">Last 7 days</span>
                        </div>

                        <!-- Industry Ranking Tablosu -->
<div class="industry-ranking-box">
  <div class="industry-ranking-header">
    <span><strong>Industry Ranking</strong> - <span id="industry-keyword"></span></span>
    <span class="industry-ranking-period">Last 7 days</span>
  </div>
  <table class="industry-ranking-table">
    <thead>
      <tr>
        <th>#</th>
        <th>Brand</th>
        <th>Position</th>
        <th>Visibility</th>
        <th>Score</th>
      </tr>
    </thead>
    <tbody id="industry-ranking-body">
      <!-- Satırlar JS ile eklenecek -->
    </tbody>
  </table>
</div>
                    </div>
                </div>
            </div>

                <!-- Test Results Section -->
                <div id="test-results-section" class="test-results-section" style="display: none;">
                    <div class="section-header">
                        <h3><i class="fas fa-chart-line"></i> Son Test Sonuçları</h3>
                        <button class="btn" onclick="clearTestResults()">
                            <i class="fas fa-times"></i> Temizle
                        </button>
                </div>

                    <div class="test-summary-grid">
                        <div class="test-summary-card">
                            <div class="summary-header">
                                <h4 id="test-website">Website</h4>
                                <span id="test-visibility-score" class="score-badge">0%</span>
                    </div>
                            <div class="summary-content">
                                <div class="prompt-info">
                                    <h5><i class="fas fa-comment-dots"></i> Kullanılan Promptlar:</h5>
                                    <div id="test-prompts-list">
                                        <p>Prompt bilgisi test sonrasında görünecek</p>
                        </div>
                        </div>
                                <div class="summary-stats">
                                    <div class="stat">
                                        <span class="stat-label">Mention Rate</span>
                                        <span id="test-mention-rate" class="stat-value">0%</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-label">Avg Position</span>
                                        <span id="test-avg-position" class="stat-value">-</span>
                                    </div>
                                    <div class="stat">
                                        <span class="stat-label">Total Tests</span>
                                        <span id="test-total-tests" class="stat-value">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>

                    <!-- Detailed Test Results -->
                    <div class="detailed-test-results">
                        <h4><i class="fas fa-list-alt"></i> Detaylı Test Sonuçları</h4>
                        <div id="detailed-test-results-content">
                            <p>Test sonuçları burada görünecek...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- REAL API Test Tab -->
            <div id="real-api-test-tab" class="tab-content">
    <div class="header">
        <h1>Prompt Analizi</h1>
    </div>
    <div class="tool-card">
        <div class="tool-header">
            <h3><i class="fas fa-comment-dots"></i> Prompt Analizi</h3>
            <p>Bir website'nin AI modellerinde nasıl göründüğünü test edin. Gemini AI ile gerçek zamanlı analiz yapın.</p>
        </div>
        <form id="promptAnalyzeForm" onsubmit="event.preventDefault(); startRealAITestInline();">
            <div class="form-group">
                <label for="websiteInputInline">🌐 Website URL:</label>
                <input type="text" id="websiteInputInline" placeholder="örn: workexe.co" class="form-input">
            </div>
            <div class="form-group">
                <label for="customPromptInline">💭 Özel Prompt:</label>
                <textarea id="customPromptInline" placeholder="Test etmek istediğiniz soruyu girin..." class="form-textarea"></textarea>
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" type="submit">
                    <i class="fas fa-play"></i> Testi Başlat
                </button>
            </div>
        </form>
        <div id="inlineTestLoading" class="test-loading" style="display: none;">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <h4 id="inlineLoadingTitle">🚀 Test Başlatılıyor...</h4>
                <p id="inlineLoadingMessage">Lütfen bekleyin...</p>
            </div>
        </div>
        <div id="inlineTestResults" class="test-results" style="display: none;">
            <div id="inlineResultsContent"></div>
        </div>
    </div>
</div>
            <!-- Insights Tab -->
            <div id="insights-tab" class="tab-content">
                <div class="header">
                    <h1>Insights & Analytics</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="generateInsights()">
                            <i class="fas fa-magic"></i> Analiz Oluştur
                        </button>
                        <button class="btn btn-secondary" onclick="loadInsightsFromRecentTest()">
                            <i class="fas fa-database"></i> Kayıtlı Verilerden Yükle
                        </button>
                        <button class="btn" onclick="runRealVisibilityTest()">
                            <i class="fas fa-rocket"></i> Yeni Test
                        </button>
                </div>
                </div>

                <!-- Project Selection -->
                <div class="project-selection">
                    <h3><i class="fas fa-filter"></i> Proje Filtreleme</h3>
                    <div class="project-filters">
                        <div class="filter-group">
                            <label>Proje Seçin:</label>
                            <select id="project-filter" onchange="filterInsightsByProject()">
                                <option value="">Tüm Projeler</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Prompt Filtresi:</label>
                            <select id="prompt-filter" onchange="filterInsightsByPrompt()">
                                <option value="">Tüm Promptlar</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Tarih Aralığı:</label>
                            <select id="date-filter" onchange="filterInsightsByDate()">
                                <option value="">Tüm Tarihler</option>
                                <option value="today">Bugün</option>
                                <option value="week">Bu Hafta</option>
                                <option value="month">Bu Ay</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button class="btn btn-outline" onclick="clearInsightsFilters()">
                            <i class="fas fa-times"></i> Filtreleri Temizle
                        </button>
                        <button class="btn btn-info" onclick="refreshProjectData()">
                            <i class="fas fa-sync"></i> Verileri Yenile
                        </button>
                    </div>
                </div>

                <!-- AI Performance Insights -->
                <div class="insights-grid">
                    <div class="insight-card">
                        <div class="insight-header">
                            <h3><i class="fas fa-chart-line"></i> Visibility Trend Analysis</h3>
                        </div>
                        <div class="insight-content">
                            <div id="trend-analysis">
                                <div class="insight-placeholder">
                                    <i class="fas fa-chart-line" style="font-size: 48px; color: #e5e7eb; margin-bottom: 16px;"></i>
                                    <p>Test sonuçlarınızı analiz etmek için bir test çalıştırın veya "Analiz Oluştur" butonuna tıklayın.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="insight-card">
                        <div class="insight-header">
                            <h3><i class="fas fa-lightbulb"></i> AI Recommendations</h3>
                        </div>
                        <div class="insight-content">
                            <div id="ai-recommendations">
                                <div class="insight-placeholder">
                                    <i class="fas fa-lightbulb" style="font-size: 48px; color: #e5e7eb; margin-bottom: 16px;"></i>
                                    <p>AI önerileri burada görünecek.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="insight-card">
                        <div class="insight-header">
                            <h3><i class="fas fa-target"></i> Competitive Analysis</h3>
                        </div>
                        <div class="insight-content">
                            <div id="competitive-analysis">
                                <div class="insight-placeholder">
                                    <i class="fas fa-target" style="font-size: 48px; color: #e5e7eb; margin-bottom: 16px;"></i>
                                    <p>Rakip analizi sonuçları burada görünecek.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="insight-card">
                        <div class="insight-header">
                            <h3><i class="fas fa-rocket"></i> Performance Predictions</h3>
                        </div>
                        <div class="insight-content">
                            <div id="performance-predictions">
                                <div class="insight-placeholder">
                                    <i class="fas fa-rocket" style="font-size: 48px; color: #e5e7eb; margin-bottom: 16px;"></i>
                                    <p>Performans tahminleri burada görünecek.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Detailed Insights -->
                <div class="detailed-insights">
                    <h3>Detaylı Analiz</h3>
                    <div id="detailed-insights-content">
                        <div class="insight-placeholder">
                            <i class="fas fa-analytics" style="font-size: 48px; color: #e5e7eb; margin-bottom: 16px;"></i>
                            <p>Test sonuçlarınızı analiz etmek için bir test çalıştırın.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sources Tab -->
            <div id="sources-tab" class="tab-content">
                <div class="header">
                    <h1>Sources</h1>
                </div>
                <div class="tool-card">
                    <h3>URL Management</h3>
                    <p>Yakında eklenecek...</p>
                </div>
            </div>

            <!-- Loading -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Analiz yapılıyor...</p>
            </div>

            <!-- Results -->
            <div id="results" class="results-section">
                <div class="results-header">
                    <h2 id="results-title">Analiz Sonuçları</h2>
                </div>
                <div id="results-content"></div>
            </div>
        </main>
    </div>

    <!-- Real AI Test Modal -->
    <div id="aiTestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-rocket"></i> Real AI Visibility Test</h3>
                <span class="modal-close" onclick="closeAITestModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="testForm" class="test-form">
                    <div class="form-group">
                        <label for="websiteInput">🌐 Website URL:</label>
                        <input type="text" id="websiteInput" placeholder="örn: workexe.co" class="form-input">
                        <small class="form-hint">Test edilecek website'in URL'ini girin (http/https olmadan)</small>
                    </div>
                    <div class="form-group">
                        <label for="customPrompt">💭 Özel Prompt:</label>
                        <textarea id="customPrompt" placeholder="Test etmek istediğiniz soruyu girin..." class="form-textarea"></textarea>
                    </div>
                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="closeAITestModal()">İptal</button>
                        <button class="btn btn-primary" onclick="startRealAITest()" id="startTestBtn">
                            <i class="fas fa-play"></i> Testi Başlat
                        </button>
                    </div>
                </div>
                <!-- Loading Screen -->
                <div id="testLoading" class="test-loading" style="display: none;">
                    <div class="loading-content">
                        <div class="loading-spinner"></div>
                        <h4 id="loadingTitle">🚀 Gemini AI Test Başlatılıyor...</h4>
                        <p id="loadingMessage">Lütfen bekleyin, bu işlem birkaç dakika sürebilir.</p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div id="progressText" class="progress-text">0%</div>
                    </div>
                </div>
                
                <!-- Results Section -->
                <div id="testResults" class="test-results" style="display: none;">
                    <div class="results-header">
                        <h4><i class="fas fa-chart-line"></i> Test Sonuçları</h4>
                        <button class="btn btn-sm" onclick="downloadResults()">
                            <i class="fas fa-download"></i> İndir
                        </button>
                    </div>
                    <div id="resultsContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTab = 'dashboard';
        let lastTestResults = null;
        const API_BASE = 'http://localhost:8000';

        // Tab switching
        document.addEventListener('DOMContentLoaded', function() {
            const navLinks = document.querySelectorAll('.nav-link');
            const tabContents = document.querySelectorAll('.tab-content');

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and links
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    navLinks.forEach(nl => nl.classList.remove('active'));
                    
                    // Add active class to clicked tab and link
                    document.getElementById(tabId + '-tab').classList.add('active');
                    this.classList.add('active');
                    
                    currentTab = tabId;
                });
            });

            // Sayfa ilk açıldığında dashboard'u göster
            document.getElementById('dashboard-tab').classList.add('active');
        });

        // Dashboard data loading
        async function loadDashboardData() {
            try {
                const response = await fetch(`${API_BASE}/get-dashboard-stats`);
                const data = await response.json();
                
                if (data.status === 'success') {
                    updateDashboardStats(data.data);
                }
            } catch (error) {
                console.error('Dashboard data loading error:', error);
            }
        }

        function updateDashboardStats(stats) {
            document.getElementById('visibility-score').textContent = stats.visibility_score + '%';
            document.getElementById('total-mentions').textContent = stats.total_mentions;
            document.getElementById('avg-position').textContent = stats.avg_score;
            document.getElementById('ai-models').textContent = stats.total_analysis;
        }

        // Update dashboard with test results
        function updateDashboardWithTestResults(testData) {
            const summary = testData.summary;
            const website = testData.website;
            
            // Update all dashboard stats with dynamic values
            updateDashboardStats(summary);
            
            // Update test results section
            updateTestResultsSection(testData);
            
            // Update dashboard cards with website-specific information
            updateDashboardCards(website, summary);
            
            // Show test results section
            document.getElementById('test-results-section').style.display = 'block';
            
            // Update industry ranking with test results
            updateIndustryRanking(testData);
            
            // Update visibility chart with test data
            updateVisibilityChart(testData);
            
            // Update trend indicators
            updateTrendIndicators(summary);
            
            // Store results for insights
            lastTestResults = testData;
        }

        // Update dashboard statistics
        function updateDashboardStats(summary) {
            document.getElementById('current-visibility-score').textContent = summary.average_visibility_score + '%';
            document.getElementById('visibility-score').textContent = summary.average_visibility_score + '%';
            document.getElementById('total-mentions').textContent = summary.mentioned_count;
            document.getElementById('avg-position').textContent = summary.best_performing_prompt ? summary.best_performing_prompt.ranking : 'N/A';
            document.getElementById('ai-models').textContent = summary.successful_tests;
        }

        // Update test results section
        function updateTestResultsSection(testData) {
            const summary = testData.summary;
            const testResults = testData.test_results || [];
            
            // Update basic info
            document.getElementById('test-website').textContent = testData.website;
            document.getElementById('test-visibility-score').textContent = summary.average_visibility_score + '%';
            document.getElementById('test-mention-rate').textContent = summary.mention_rate + '%';
            document.getElementById('test-avg-position').textContent = summary.best_performing_prompt ? summary.best_performing_prompt.ranking : '-';
            document.getElementById('test-total-tests').textContent = summary.successful_tests || testResults.length;
            
            // Update prompts list
            updatePromptsList(testData);
            
            // Update detailed test results
            updateDetailedTestResults(testData);
        }

        // Update prompts list
        function updatePromptsList(testData) {
            const promptsListElement = document.getElementById('test-prompts-list');
            if (!promptsListElement) return;
            
            const testResults = testData.test_results || [];
            const customPrompts = testData.custom_prompts || [];
            const testPrompts = testData.test_prompts || [];
            const summary = testData.summary || {};
            
            let promptsHTML = '';
            
            if (customPrompts.length > 0) {
                // Custom prompts were used
                customPrompts.forEach((prompt, index) => {
                    const result = testResults[index] || {};
                    const statusClass = result.mentioned ? 'success' : 'danger';
                    const statusIcon = result.mentioned ? '✅' : '❌';
                    
                    promptsHTML += `
                        <div class="prompt-item ${statusClass}">
                            <div class="prompt-header">
                                <span class="prompt-number">#${index + 1}</span>
                                <span class="prompt-status">${statusIcon} ${result.visibility_score || 0}%</span>
                            </div>
                            <div class="prompt-text">${prompt}</div>
                            <div class="prompt-meta">
                                <span>Ranking: ${result.ranking || 'N/A'}</span>
                                <span>Sentiment: ${result.sentiment || 'N/A'}</span>
                            </div>
                        </div>
                    `;
                });
            } else if (testPrompts.length > 0) {
                // Test prompts from AI response
                testPrompts.forEach((prompt, index) => {
                    const result = testResults[index] || {};
                    const statusClass = result.mentioned ? 'success' : 'danger';
                    const statusIcon = result.mentioned ? '✅' : '❌';
                    
                    promptsHTML += `
                        <div class="prompt-item ${statusClass}">
                            <div class="prompt-header">
                                <span class="prompt-number">#${index + 1}</span>
                                <span class="prompt-status">${statusIcon} ${result.visibility_score || 0}%</span>
                            </div>
                            <div class="prompt-text">${prompt}</div>
                            <div class="prompt-meta">
                                <span>Ranking: ${result.ranking || 'N/A'}</span>
                                <span>Sentiment: ${result.sentiment || 'N/A'}</span>
                            </div>
                        </div>
                    `;
                });
            } else {
                // Auto prompts were used
                promptsHTML = `
                    <div class="prompt-item info">
                        <div class="prompt-header">
                            <span class="prompt-status">🤖 Otomatik Test</span>
                        </div>
                        <div class="prompt-text">Gemini AI otomatik olarak website analizi yapıldı</div>
                        <div class="prompt-meta">
                            <span>Visibility Score: ${summary.average_visibility_score || 0}%</span>
                            <span>Mention Rate: ${summary.mention_rate || 0}%</span>
                        </div>
                    </div>
                `;
            }
            
            promptsListElement.innerHTML = promptsHTML;
        }

        // Update detailed test results
        function updateDetailedTestResults(testData) {
            const detailedResultsElement = document.getElementById('detailed-test-results-content');
            if (!detailedResultsElement) return;
            
            const testResults = testData.test_results || [];
            
            if (testResults.length === 0) {
                detailedResultsElement.innerHTML = '<p>Detaylı test sonuçları bulunamadı.</p>';
                return;
            }
            
            let detailedHTML = '';
            
            testResults.forEach((result, index) => {
                if (!result.error) {
                    const statusClass = result.mentioned ? 'success' : 'danger';
                    const statusIcon = result.mentioned ? '✅' : '❌';
                    
                    detailedHTML += `
                        <div class="detailed-test-item ${statusClass}">
                            <div class="detailed-test-header">
                                <span class="test-number">Test #${index + 1}</span>
                                <span class="test-status">${statusIcon} ${result.visibility_score || 0}%</span>
                            </div>
                            <div class="test-prompt-detail">
                                <strong>Prompt:</strong> ${result.prompt || 'Otomatik test'}
                            </div>
                            <div class="test-response-detail">
                                <strong>AI Response:</strong>
                                <div class="response-content">
                                    ${result.response || 'Yanıt bulunamadı'}
                                </div>
                            </div>
                            <div class="test-metrics">
                                <span class="metric">
                                    <i class="fas fa-chart-line"></i>
                                    Ranking: ${result.ranking || 'N/A'}
                                </span>
                                <span class="metric">
                                    <i class="fas fa-heart"></i>
                                    Sentiment: ${result.sentiment || 'N/A'}
                                </span>
                                <span class="metric">
                                    <i class="fas fa-eye"></i>
                                    Visibility: ${result.visibility_score || 0}%
                                </span>
                            </div>
                        </div>
                    `;
                }
            });
            
            detailedResultsElement.innerHTML = detailedHTML;
        }

        // Update dashboard cards with website-specific information
        function updateDashboardCards(website, summary) {
            const websiteDomain = website.replace(/^https?:\/\//, '').replace(/^www\./, '');
            const industryKeywords = extractIndustryKeywords(websiteDomain);
            
            // Update card titles and descriptions
            updateCardContent('visibility-card', {
                title: 'Visibility Score',
                subtitle: `${websiteDomain} için`,
                description: `Bu site için ${summary.average_visibility_score}% görünürlük skoru elde edildi.`,
                icon: 'fa-eye'
            });
            
            updateCardContent('mentions-card', {
                title: 'Total Mentions',
                subtitle: `${websiteDomain} için`,
                description: `${summary.mentioned_count} başarılı mention tespit edildi.`,
                icon: 'fa-check-circle'
            });
            
            updateCardContent('position-card', {
                title: 'Average Position',
                subtitle: `${websiteDomain} için`,
                description: `En iyi performans: ${summary.best_performing_prompt ? summary.best_performing_prompt.ranking : 'N/A'}. sıra.`,
                icon: 'fa-chart-line'
            });
            
            updateCardContent('models-card', {
                title: 'AI Models',
                subtitle: `${websiteDomain} için`,
                description: `${summary.successful_tests} AI modeli başarıyla test edildi.`,
                icon: 'fa-robot'
            });
            
            // Update dashboard header
            updateDashboardHeader(website);
        }

        // Update individual card content
        function updateCardContent(cardId, content) {
            const card = document.getElementById(cardId);
            if (!card) return
            const titleElement = card.querySelector('.stat-title');
            const subtitleElement = card.querySelector('.stat-subtitle');
            const descriptionElement = card.querySelector('.stat-description');
            const iconElement = card.querySelector('.stat-icon i');
            
            if (titleElement) titleElement.textContent = content.title;
            if (subtitleElement) subtitleElement.textContent = content.subtitle;
            if (descriptionElement) descriptionElement.textContent = content.description;
            if (iconElement) iconElement.className = `fas ${content.icon}`;
        }

        // Update industry ranking based on test results
        function updateIndustryRanking(testData) {
            const summary = testData.summary;
            const bestPrompt = summary.best_performing_prompt;
            const website = testData.website;
            
            // Generate competitors based on the actual test results and prompt analysis
            const competitors = generateCompetitorsFromTestResults(testData);
            
            const tbody = document.getElementById('industry-ranking-body');
            tbody.innerHTML = '';
            
            competitors.forEach((competitor, index) => {
                const isUserSite = competitor.name === website;
                const row = document.createElement('tr');
                if (isUserSite) {
                    row.style.backgroundColor = '#f0f9ff';
                    row.style.borderLeft = '4px solid var(--primary-color)';
                }
                
                const scoreClass = competitor.score >= 70 ? 'excellent' : competitor.score >= 40 ? 'good' : 'average';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>
                        <div class="brand-info">
                            <div class="brand-icon" style="background: ${isUserSite ? '#4f46e5' : '#6b7280'};">
                                ${competitor.name.charAt(0).toUpperCase()}
                            </div>
                            ${competitor.name}${isUserSite ? ' <span style="color: #4f46e5; font-weight: 600;">(Sizin)</span>' : ''}
                        </div>
                    </td>
                    <td>${competitor.position}</td>
                    <td>${competitor.visibility.toFixed(1)}%</td>
                    <td><span class="score-badge ${scoreClass}">${Math.round(competitor.score)}</span></td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Update ranking header with website and prompt info
            const rankingHeader = document.querySelector('.ranking-header h3');
            if (rankingHeader) {
                const promptInfo = bestPrompt ? ` - "${bestPrompt.prompt}"` : '';
                rankingHeader.innerHTML = `Industry Ranking <span style="font-size: 14px; color: #6b7280; font-weight: 400;">- ${website} için${promptInfo}</span>`;
            }
        }

        // Generate competitors based on actual test results
        function generateCompetitorsFromTestResults(testData) {
            const website = testData.website;
            const summary = testData.summary;
            const testResults = testData.test_results || [];
            
            // Extract actual companies mentioned in test results
            const mentionedCompanies = extractCompaniesFromTestResults(testResults);
            
            // Create ranking based on actual test data
            const competitors = [];
            
            // Add user's website first
            competitors.push({
                name: website,
                position: summary.best_performing_prompt ? summary.best_performing_prompt.ranking : 1,
                visibility: summary.average_visibility_score,
                score: summary.average_visibility_score
            });
            
            // Add companies found in test results
            mentionedCompanies.forEach((company, index) => {
                competitors.push({
                    name: company.name,
                    position: company.ranking || (index + 2),
                    visibility: company.visibility || Math.max(0, summary.average_visibility_score - (index + 1) * 5),
                    score: company.score || Math.max(0, summary.average_visibility_score - (index + 1) * 3)
                });
            });
            
            // If we don't have enough companies from test results, add some industry-related ones
            if (competitors.length < 5) {
                const additionalCompetitors = generateAdditionalCompetitors(website, summary, competitors.length);
                competitors.push(...additionalCompetitors);
            }
            
            // Sort by position (ascending)
            competitors.sort((a, b) => a.position - b.position);
            
            return competitors.slice(0, 5); // Return top 5
        }

        // Extract companies mentioned in test results
        function extractCompaniesFromTestResults(testResults) {
            const companies = [];
            
            testResults.forEach((result, index) => {
                if (result.response && !result.error) {
                    // Look for company names in the response
                    const companyNames = extractCompanyNamesFromResponse(result.response);
                    
                    companyNames.forEach((companyName, companyIndex) => {
                        if (companyName && companyName.length > 3) {
                            companies.push({
                                name: companyName,
                                ranking: result.ranking || (index + 2),
                                visibility: result.visibility_score || 0,
                                score: result.visibility_score || 0
                            });
                        }
                    });
                }
            });
            
            return companies;
        }

        // Extract company names from AI response
        function extractCompanyNamesFromResponse(response) {
            const companies = [];
            
            // Common patterns for company mentions
            const patterns = [
                /(?:company|firm|brand|startup|business|enterprise|corporation|inc|corp|llc|ltd)\s*[:\s]\s*([a-zA-Z0-9\s\-\.]+)/gi,
                /(?:mentioned|referenced|cited|discussed)\s+(?:companies?|brands?|firms?)\s*[:\s]\s*([a-zA-Z0-9\s\-\.]+)/gi,
                /(?:competitors?|alternatives?|similar)\s*[:\s]\s*([a-zA-Z0-9\s\-\.]+)/gi
            ];
            
            patterns.forEach(pattern => {
                const matches = response.match(pattern);
                if (matches) {
                    matches.forEach(match => {
                        const companyName = match.replace(/^[^:]*:\s*/, '').trim();
                        if (companyName && companyName.length > 3) {
                            companies.push(companyName);
                        }
                    });
                }
            });
            
            // Also look for domain-like patterns
            const domainPattern = /([a-zA-Z0-9\-]+\.(?:com|net|org|io|co|ai|tech))/gi;
            const domainMatches = response.match(domainPattern);
            if (domainMatches) {
                companies.push(...domainMatches);
            }
            
            return [...new Set(companies)]; // Remove duplicates
        }

        // Generate additional competitors if needed
        function generateAdditionalCompetitors(website, summary, currentCount) {
            const websiteDomain = website.replace(/^https?:\/\//, '').replace(/^www\./, '');
            const industryKeywords = extractIndustryKeywords(websiteDomain);
            const userScore = summary.average_visibility_score;
            
            const additionalCompetitors = [];
            const needed = 5 - currentCount;
            
            for (let i = 0; i < needed; i++) {
                const competitorPosition = currentCount + i + 1;
                const competitorScore = Math.max(0, userScore - (i + 1) * 8);
                const competitorVisibility = Math.max(0, userScore - (i + 1) * 10);
                
                additionalCompetitors.push({
                    name: generateCompetitorName(industryKeywords, i + currentCount),
                    position: competitorPosition,
                    visibility: competitorVisibility,
                    score: competitorScore
                });
            }
            
            return additionalCompetitors;
        }



        // Extract industry keywords from website domain
        function extractIndustryKeywords(domain) {
            const domainLower = domain.toLowerCase();
            
            // Common industry patterns
            if (domainLower.includes('tech') || domainLower.includes('software') || domainLower.includes('app')) {
                return ['tech', 'software', 'app', 'digital'];
            } else if (domainLower.includes('ecommerce') || domainLower.includes('shop') || domainLower.includes('store')) {
                return ['ecommerce', 'retail', 'shop', 'store'];
            } else if (domainLower.includes('finance') || domainLower.includes('bank') || domainLower.includes('pay')) {
                return ['finance', 'banking', 'payments', 'fintech'];
            } else if (domainLower.includes('health') || domainLower.includes('medical') || domainLower.includes('care')) {
                return ['health', 'medical', 'care', 'wellness'];
            } else if (domainLower.includes('education') || domainLower.includes('learn') || domainLower.includes('school')) {
                return ['education', 'learning', 'school', 'training'];
            } else if (domainLower.includes('marketing') || domainLower.includes('ad') || domainLower.includes('seo')) {
                return ['marketing', 'advertising', 'seo', 'digital'];
            } else {
                return ['business', 'service', 'company', 'corp'];
            }
        }

        // Generate realistic competitor names
        function generateCompetitorName(industryKeywords, index) {
            const prefixes = ['global', 'premium', 'elite', 'pro', 'smart', 'next', 'future', 'core', 'prime', 'vital'];
            const suffixes = ['tech', 'solutions', 'systems', 'group', 'labs', 'works', 'hub', 'studio', 'agency', 'inc'];
            
            const prefix = prefixes[index % prefixes.length];
            const suffix = suffixes[(index + 2) % suffixes.length];
            const keyword = industryKeywords[index % industryKeywords.length];
            
            return `${prefix}${keyword}.com`;
        }

        // Update visibility chart with test data
        function updateVisibilityChart(testData) {
            const summary = testData.summary;
            const score = summary.average_visibility_score;
            
            // Generate historical data based on current score
            const historicalData = generateHistoricalData(score);
            
            // Update chart
            const chartElement = document.getElementById('visibilityChart');
            if (!chartElement) {
                console.warn('Visibility chart element not found');
                return;
            }
            
            const ctx = chartElement.getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.visibilityChart && typeof window.visibilityChart.destroy === 'function') {
                window.visibilityChart.destroy();
            }
            
            window.visibilityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1 hafta önce', '6 gün önce', '5 gün önce', '4 gün önce', '3 gün önce', '2 gün önce', 'Bugün'],
                    datasets: [{
                        label: 'Visibility %',
                        data: historicalData,
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#4f46e5',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#4f46e5',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        y: {
                            display: true,
                            beginAtZero: true,
                            max: Math.max(100, score + 20),
                            grid: {
                                color: '#f3f4f6'
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
        }

        // Generate historical data based on current score
        function generateHistoricalData(currentScore) {
            const data = [];
            const baseScore = currentScore * 0.7; // Start from 70% of current score
            
            for (let i = 0; i < 7; i++) {
                if (i === 6) {
                    // Today's score
                    data.push(currentScore);
                } else {
                    // Historical data with gradual improvement
                    const historicalScore = Math.max(0, Math.min(100, baseScore + (i * 4)));
                    data.push(Math.round(historicalScore));
                }
            }
            
            return data;
        }

        // Update trend indicators
        function updateTrendIndicators(summary) {
            const score = summary.average_visibility_score;
            const mentionRate = summary.mention_rate;
            
            // Calculate trends based on current performance
            const visibilityTrend = calculateTrend(score);
            const mentionTrend = calculateTrend(mentionRate);
            const positionTrend = summary.best_performing_prompt ? calculatePositionTrend(summary.best_performing_prompt.ranking) : 'neutral';
            const modelTrend = calculateModelTrend(summary.successful_tests);
            
            // Update trend indicators
            updateTrendIndicator('visibility-score', visibilityTrend);
            updateTrendIndicator('total-mentions', mentionTrend);
            updateTrendIndicator('avg-position', positionTrend);
            updateTrendIndicator('ai-models', modelTrend);
        }

        // Calculate trend based on score
        function calculateTrend(score) {
            if (score >= 80) return 'strong-positive';
            if (score >= 60) return 'positive';
            if (score >= 40) return 'neutral';
            return 'negative';
        }

        // Calculate position trend (lower is better)
        function calculatePositionTrend(position) {
            if (position <= 3) return 'strong-positive';
            if (position <= 5) return 'positive';
            if (position <= 10) return 'neutral';
            return 'negative';
        }

        // Calculate model trend
        function calculateModelTrend(successfulTests) {
            if (successfulTests >= 8) return 'strong-positive';
            if (successfulTests >= 5) return 'positive';
            if (successfulTests >= 3) return 'neutral';
            return 'negative';
        }

        // Update trend indicator
        function updateTrendIndicator(elementId, trend) {
            const element = document.querySelector(`#${elementId}`).closest('.stat-card').querySelector('.stat-change');
            const icon = element.querySelector('i');
            const text = element.textContent;
            
            // Remove existing classes
            element.classList.remove('positive', 'negative');
            icon.classList.remove('fa-arrow-up', 'fa-arrow-down');
            
            // Add new classes based on trend
            if (trend === 'strong-positive' || trend === 'positive') {
                element.classList.add('positive');
                icon.classList.add('fa-arrow-up');
                const improvement = trend === 'strong-positive' ? 12 : 8;
                element.innerHTML = `<i class="fas fa-arrow-up"></i> +${improvement}%`;
            } else if (trend === 'negative') {
                element.classList.add('negative');
                icon.classList.add('fa-arrow-down');
                const decline = 6;
                element.innerHTML = `<i class="fas fa-arrow-down"></i> -${decline}%`;
            } else {
                element.innerHTML = `<i class="fas fa-minus"></i> 0%`;
            }
        }

        // Clear test results
        function clearTestResults() {
            document.getElementById('test-results-section').style.display = 'none';
            lastTestResults = null;
            
            // Reset dashboard to default values
            resetDashboardToDefault();
            
            // Reset trend indicators to default
            resetTrendIndicators();
            
            // Reset to default ranking
            resetIndustryRanking();
            
            // Reset chart to default
            resetVisibilityChart();

            // Reset test results section elements
            const promptsList = document.getElementById('test-prompts-list');
            if (promptsList) {
                promptsList.innerHTML = '<p>Prompt bilgisi test sonrasında görünecek</p>';
            }

            const detailedResults = document.getElementById('detailed-test-results-content');
            if (detailedResults) {
                detailedResults.innerHTML = '<p>Test sonuçları burada görünecek...</p>';
            }
        }

        // Reset dashboard to default values
        function resetDashboardToDefault() {
            // Reset stats
            document.getElementById('current-visibility-score').textContent = '17%';
            document.getElementById('visibility-score').textContent = '17%';
            document.getElementById('total-mentions').textContent = '127';
            document.getElementById('avg-position').textContent = '3.2';
            document.getElementById('ai-models').textContent = '8';
            
            // Reset card content to default
            updateCardContent('visibility-card', {
                title: 'AI Visibility Score',
                subtitle: 'Genel',
                description: 'AI modellerinde görünürlük skoru',
                icon: 'fa-eye'
            });
            
            updateCardContent('mentions-card', {
                title: 'Total Mentions',
                subtitle: 'Genel',
                description: 'Toplam mention sayısı',
                icon: 'fa-check-circle'
            });
            
            updateCardContent('position-card', {
                title: 'Avg. Position',
                subtitle: 'Genel',
                description: 'Ortalama sıralama pozisyonu',
                icon: 'fa-chart-bar'
            });
            
            updateCardContent('models-card', {
                title: 'AI Models Tracked',
                subtitle: 'Genel',
                description: 'Takip edilen AI model sayısı',
                icon: 'fa-robot'
            });
            
            // Reset dashboard header
            const dashboardTitle = document.querySelector('.dashboard-header h1');
            const dashboardSubtitle = document.querySelector('.dashboard-header p');
            
            if (dashboardTitle) {
                dashboardTitle.textContent = 'Dashboard';
            }
            
            if (dashboardSubtitle) {
                dashboardSubtitle.textContent = 'AI görünürlük analizi genel bakış';
            }

            // Reset test results section
            const testResultsSection = document.getElementById('test-results-section');
            if (testResultsSection) {
                testResultsSection.style.display = 'none';
            }

            // Reset prompts list
            const promptsList = document.getElementById('test-prompts-list');
            if (promptsList) {
                promptsList.innerHTML = '<p>Prompt bilgisi test sonrasında görünecek</p>';
            }

            // Reset detailed test results
            const detailedResults = document.getElementById('detailed-test-results-content');
            if (detailedResults) {
                detailedResults.innerHTML = '<p>Test sonuçları burada görünecek...</p>';
            }
        }

        // Reset industry ranking to default
        function resetIndustryRanking() {
            const tbody = document.getElementById('ranking-table-body');
            tbody.innerHTML = `
                <tr>
                    <td>1</td>
                    <td>
                        <div class="brand-info">
                            <div class="brand-icon" style="background: #6366f1;">I</div>
                            intercom.com
                        </div>
                    </td>
                    <td>4.2</td>
                    <td>93.4%</td>
                    <td><span class="score-badge excellent">71</span></td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>
                        <div class="brand-info">
                            <div class="brand-icon" style="background: #10b981;">Z</div>
                            zendesk.com
                        </div>
                    </td>
                    <td>3.6</td>
                    <td>86.4%</td>
                    <td><span class="score-badge excellent">75</span></td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>
                        <div class="brand-info">
                            <div class="brand-icon" style="background: #f59e0b;">H</div>
                            hubspot.com
                        </div>
                    </td>
                    <td>5.8</td>
                    <td>82.3%</td>
                    <td><span class="score-badge good">73</span></td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>
                        <div class="brand-info">
                            <div class="brand-icon" style="background: #3b82f6;">S</div>
                            salesforce.com
                        </div>
                    </td>
                    <td>7.2</td>
                    <td>73.7%</td>
                    <td><span class="score-badge good">72</span></td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>
                        <div class="brand-info">
                            <div class="brand-icon" style="background: #22c55e;">W</div>
                            workexe.co
                        </div>
                    </td>
                    <td>3.1</td>
                    <td>22.0%</td>
                    <td><span class="score-badge average">74</span></td>
                </tr>
            `;
            
            // Reset ranking header
            const rankingHeader = document.querySelector('.ranking-header h3');
            if (rankingHeader) {
                rankingHeader.innerHTML = 'Industry Ranking <span style="font-size: 14px; color: #6b7280; font-weight: 400;">- Genel</span>';
            }
        }

        // Test geçmişini yükle
        async function loadTestHistory() {
            try {
                const response = await fetch('http://localhost:8000/get-test-history');
                const data = await response.json();
                
                const recentTestsContainer = document.getElementById('recentTests');
                if (!recentTestsContainer) return;
                
                if (data.status === 'success' && data.data.length > 0) {
                    const tests = data.data.slice(0, 5); // Son 5 testi göster
                    
                    const testsHTML = tests.map((test, index) => `
                        <div class="test-history-item" onclick="loadTestDataForInsights(${index})" style="cursor: pointer;">
                            <div class="test-history-header">
                                <h4>${test.website}</h4>
                                <span class="test-date">${new Date(test.test_date).toLocaleDateString('tr-TR')}</span>
                                <i class="fas fa-mouse-pointer" style="color: var(--primary-color); font-size: 12px; margin-left: 8px;" title="Tıklayarak insights'ı görüntüle"></i>
                            </div>
                            <div class="test-history-stats">
                                <span class="stat">
                                    <i class="fas fa-eye"></i>
                                    ${test.visibility_score || 0}% Görünürlük
                                </span>
                                <span class="stat">
                                    <i class="fas fa-check"></i>
                                    ${test.mentioned_count || 0}/${test.total_tests || 0} Test
                                </span>
                            </div>
                            <div class="test-history-prompts">
                                <small>${test.prompts && test.prompts.length > 0 ? test.prompts.join(', ') : 'Test tamamlandı'}</small>
                            </div>
                        </div>
                    `).join('');
                    
                    recentTestsContainer.innerHTML = testsHTML;
                    
                    // Store the loaded test data globally for insights
                    window.loadedTestHistory = data.data;
                    
                    // Proje filtrelerini doldur
                    populateProjectFilters && populateProjectFilters();
                } else {
                    recentTestsContainer.innerHTML = '<p>Henüz test yapılmadı.</p>';
                }
            } catch (error) {
                console.error('Test geçmişi yükleme hatası:', error);
                const recentTestsContainer = document.getElementById('recentTests');
                if (recentTestsContainer) {
                    recentTestsContainer.innerHTML = '<p>Test geçmişi yüklenemedi.</p>';
                }
            }
        }

        // Test verilerini insights için yükle
        function loadTestDataForInsights(testIndex) {
            if (!window.loadedTestHistory || !window.loadedTestHistory[testIndex]) {
                alert('Test verisi bulunamadı!');
                return;
            }
            
            const testData = window.loadedTestHistory[testIndex];
            
            // Test verilerini lastTestResults formatına dönüştür
            const formattedTestData = {
                website: testData.website,
                summary: {
                    average_visibility_score: testData.visibility_score || 0,
                    mention_rate: testData.mentioned_count > 0 ? Math.round((testData.mentioned_count / Math.max(testData.total_tests, 1)) * 100) : 0,
                    mentioned_count: testData.mentioned_count || 0,
                    successful_tests: testData.total_tests || 1,
                    sentiment_breakdown: {
                        positive: Math.round((testData.visibility_score || 0) / 2),
                        neutral: Math.round((testData.visibility_score || 0) / 3),
                        negative: Math.round((testData.visibility_score || 0) / 6)
                    },
                    best_performing_prompt: {
                        prompt: testData.prompts || "AI görünürlük testi",
                        ranking: Math.round((100 - (testData.visibility_score || 0)) / 10) + 1,
                        sentiment: testData.visibility_score >= 70 ? "positive" : testData.visibility_score >= 40 ? "neutral" : "negative"
                    }
                }
            };
            
            // lastTestResults'i güncelle
            lastTestResults = formattedTestData;
            
            // Insights sekmesine geç
            showTab('insights-tab');
            
            // Insights'ı otomatik olarak oluştur
            generateInsights();
            
            // Kullanıcıya bilgi ver
            alert(`${testData.website} için kayıtlı test verileri yüklendi ve insights oluşturuldu!`);
        }

        // Proje filtreleme fonksiyonları
        function populateProjectFilters() {
            if (!window.loadedTestHistory) return;
            
            const projectFilter = document.getElementById('project-filter');
            const dashboardProjectFilter = document.getElementById('dashboard-project-filter');
            const promptFilter = document.getElementById('prompt-filter');
            const dashboardPromptFilter = document.getElementById('dashboard-prompt-filter');
            
            if (!projectFilter || !dashboardProjectFilter || !promptFilter || !dashboardPromptFilter) return;
            
            // Proje listesini oluştur
            const projects = [...new Set(window.loadedTestHistory.map(test => test.website))];
            const prompts = [...new Set(window.loadedTestHistory.map(test => test.prompts).filter(p => p))];
            
            // Proje filtrelerini doldur
            [projectFilter, dashboardProjectFilter].forEach(filter => {
                filter.innerHTML = '<option value="">Tüm Projeler</option>';
                projects.forEach(project => {
                    const option = document.createElement('option');
                    option.value = project;
                    option.textContent = project;
                    filter.appendChild(option);
                });
            });
            
            // Prompt filtrelerini doldur
            [promptFilter, dashboardPromptFilter].forEach(filter => {
                filter.innerHTML = '<option value="">Tüm Promptlar</option>';
                prompts.forEach(prompt => {
                    const option = document.createElement('option');
                    option.value = prompt;
                    option.textContent = prompt;
                    filter.appendChild(option);
                });
            });
        }

        // Insights proje filtreleme
        function filterInsightsByProject() {
            const selectedProject = document.getElementById('project-filter').value;
            const selectedPrompt = document.getElementById('prompt-filter').value;
            const selectedDate = document.getElementById('date-filter').value;
            
            filterInsights(selectedProject, selectedPrompt, selectedDate);
        }

        function filterInsightsByPrompt() {
            const selectedProject = document.getElementById('project-filter').value;
            const selectedPrompt = document.getElementById('prompt-filter').value;
            const selectedDate = document.getElementById('date-filter').value;
            
            filterInsights(selectedProject, selectedPrompt, selectedDate);
        }

        function filterInsightsByDate() {
            const selectedProject = document.getElementById('project-filter').value;
            const selectedPrompt = document.getElementById('prompt-filter').value;
            const selectedDate = document.getElementById('date-filter').value;
            
            filterInsights(selectedProject, selectedPrompt, selectedDate);
        }

        // Dashboard proje filtreleme
        function filterDashboardByProject() {
            const selectedProject = document.getElementById('dashboard-project-filter').value;
            const selectedPrompt = document.getElementById('dashboard-prompt-filter').value;
            const selectedDate = document.getElementById('dashboard-date-filter').value;
            
            filterDashboard(selectedProject, selectedPrompt, selectedDate);
        }

        function filterDashboardByPrompt() {
            const selectedProject = document.getElementById('dashboard-project-filter').value;
            const selectedPrompt = document.getElementById('dashboard-prompt-filter').value;
            const selectedDate = document.getElementById('dashboard-date-filter').value;
            
            filterDashboard(selectedProject, selectedPrompt, selectedDate);
        }

        function filterDashboardByDate() {
            const selectedProject = document.getElementById('dashboard-project-filter').value;
            const selectedPrompt = document.getElementById('dashboard-prompt-filter').value;
            const selectedDate = document.getElementById('dashboard-date-filter').value;
            
            filterDashboard(selectedProject, selectedPrompt, selectedDate);
        }

        // Ana filtreleme fonksiyonları
        function filterInsights(project, prompt, date) {
            if (!window.loadedTestHistory) return;
            
            let filteredData = window.loadedTestHistory;
            
            // Proje filtreleme
            if (project) {
                filteredData = filteredData.filter(test => test.website === project);
            }
            
            // Prompt filtreleme
            if (prompt) {
                filteredData = filteredData.filter(test => test.prompts === prompt);
            }
            
            // Tarih filtreleme
            if (date) {
                const today = new Date();
                const oneWeekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                const oneMonthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
                
                filteredData = filteredData.filter(test => {
                    const testDate = new Date(test.test_date);
                    switch (date) {
                        case 'today':
                            return testDate.toDateString() === today.toDateString();
                        case 'week':
                            return testDate >= oneWeekAgo;
                        case 'month':
                            return testDate >= oneMonthAgo;
                        default:
                            return true;
                    }
                });
            }
            
            // Filtrelenmiş verilerle insights güncelle
            if (filteredData.length > 0) {
                const firstTest = filteredData[0];
                loadTestDataForInsights(window.loadedTestHistory.findIndex(test => test === firstTest));
            } else {
                alert('Seçilen kriterlere uygun test bulunamadı!');
            }
        }

        function filterDashboard(project, prompt, date) {
            if (!window.loadedTestHistory) return;
            
            let filteredData = window.loadedTestHistory;
            
            // Proje filtreleme
            if (project) {
                filteredData = filteredData.filter(test => test.website === project);
            }
            
            // Prompt filtreleme
            if (prompt) {
                filteredData = filteredData.filter(test => test.prompts === prompt);
            }
            
            // Tarih filtreleme
            if (date) {
                const today = new Date();
                const oneWeekAgo = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
                const oneMonthAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
                
                filteredData = filteredData.filter(test => {
                    const testDate = new Date(test.test_date);
                    switch (date) {
                        case 'today':
                            return testDate.toDateString() === today.toDateString();
                        case 'week':
                            return testDate >= oneWeekAgo;
                        case 'month':
                            return testDate >= oneMonthAgo;
                        default:
                            return true;
                    }
                });
            }
            
            // Filtrelenmiş verilerle dashboard güncelle
            if (filteredData.length > 0) {
                const firstTest = filteredData[0];
                const formattedTestData = {
                    website: firstTest.website,
                    summary: {
                        average_visibility_score: firstTest.visibility_score || 0,
                        mention_rate: firstTest.mentioned_count > 0 ? Math.round((firstTest.mentioned_count / Math.max(firstTest.total_tests, 1)) * 100) : 0,
                        mentioned_count: firstTest.mentioned_count || 0,
                        successful_tests: firstTest.total_tests || 1,
                        best_performing_prompt: {
                            prompt: firstTest.prompts || "AI görünürlük testi",
                            ranking: Math.round((100 - (firstTest.visibility_score || 0)) / 10) + 1
                        }
                    }
                };
                
                updateDashboardWithTestResults(formattedTestData);
            } else {
                alert('Seçilen kriterlere uygun test bulunamadı!');
            }
        }

        // Filtreleri temizle
        function clearInsightsFilters() {
            document.getElementById('project-filter').value = '';
            document.getElementById('prompt-filter').value = '';
            document.getElementById('date-filter').value = '';
            
            if (window.loadedTestHistory && window.loadedTestHistory.length > 0) {
                loadTestDataForInsights(0);
            }
        }

        function clearDashboardFilters() {
            document.getElementById('dashboard-project-filter').value = '';
            document.getElementById('dashboard-prompt-filter').value = '';
            document.getElementById('dashboard-date-filter').value = '';
            
            resetDashboardToDefault();
        }

        // Verileri yenile
        function refreshProjectData() {
            loadTestHistory().then(() => {
                populateProjectFilters();
            });
        }

        function refreshDashboardData() {
            loadTestHistory().then(() => {
                populateProjectFilters();
                if (window.loadedTestHistory && window.loadedTestHistory.length > 0) {
                    loadTestDataForInsights(0);
                }
            });
        }

        // Reset trend indicators to default
        function resetTrendIndicators() {
            const defaultTrends = {
                'visibility-score': { trend: 'positive', value: '+2.3%' },
                'total-mentions': { trend: 'positive', value: '+12.5%' },
                'avg-position': { trend: 'negative', value: '-0.8' },
                'ai-models': { trend: 'positive', value: '+2' }
            };
            
            Object.entries(defaultTrends).forEach(([elementId, data]) => {
                const element = document.querySelector(`#${elementId}`).closest('.stat-card').querySelector('.stat-change');
                const icon = element.querySelector('i');
                
                element.classList.remove('positive', 'negative');
                icon.classList.remove('fa-arrow-up', 'fa-arrow-down', 'fa-minus');
                
                if (data.trend === 'positive') {
                    element.classList.add('positive');
                    icon.classList.add('fa-arrow-up');
                    element.innerHTML = `<i class="fas fa-arrow-up"></i> ${data.value}`;
                } else if (data.trend === 'negative') {
                    element.classList.add('negative');
                    icon.classList.add('fa-arrow-down');
                    element.innerHTML = `<i class="fas fa-arrow-down"></i> ${data.value}`;
                }
            });
        }

        // Reset visibility chart to default
        function resetVisibilityChart() {
            const chartElement = document.getElementById('visibilityChart');
            if (!chartElement) {
                console.warn('Visibility chart element not found');
                return;
            }
            
            const ctx = chartElement.getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.visibilityChart && typeof window.visibilityChart.destroy === 'function') {
                window.visibilityChart.destroy();
            }
            
            window.visibilityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jul 15', 'Jul 16', 'Jul 17', 'Jul 18', 'Jul 19', 'Jul 20', 'Jul 21'],
                    datasets: [{
                        label: 'Visibility %',
                        data: [15, 12, 14, 16, 18, 17, 17],
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            display: true,
                            beginAtZero: true,
                            max: 25
                        }
                    }
                }
            });
        }

        // Generate insights
        function generateInsights() {
            if (!lastTestResults) {
                alert('Önce bir test çalıştırın!');
                return;
            }
            
            const summary = lastTestResults.summary;
            const website = lastTestResults.website;
            
            // Update trend analysis
            const trendAnalysis = getTrendAnalysis(summary);
            document.getElementById('trend-analysis').innerHTML = `
                <div style="margin-bottom: 16px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 12px;">📈 Visibility Trend</h4>
                    <div style="background: #f8fafc; padding: 16px; border-radius: 8px; margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span><strong>Mevcut Skor:</strong></span>
                            <span style="font-size: 24px; font-weight: 700; color: ${getScoreColor(summary.average_visibility_score)}">${summary.average_visibility_score}%</span>
                </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>Mention Rate:</strong></span>
                            <span style="font-weight: 600;">${summary.mention_rate}%</span>
                </div>
                </div>
                    <p style="font-size: 14px; line-height: 1.5;">${trendAnalysis}</p>
            </div>
            `;

            // Update AI recommendations
            const recommendations = getAIRecommendations(summary, website);
            document.getElementById('ai-recommendations').innerHTML = `
                <div style="margin-bottom: 16px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 12px;">💡 AI Önerileri</h4>
                    <div style="background: #f0f9ff; padding: 16px; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                        ${recommendations.map(rec => `<p style="margin-bottom: 8px; font-size: 14px;">• ${rec}</p>`).join('')}
            </div>
        </div>
    `;
    
            // Update competitive analysis
            const competitiveAnalysis = getCompetitiveAnalysis(summary);
            document.getElementById('competitive-analysis').innerHTML = `
                <div style="margin-bottom: 16px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 12px;">🎯 Rakip Analizi</h4>
                    <div style="background: #fef3c7; padding: 16px; border-radius: 8px; border-left: 4px solid #f59e0b;">
                        ${competitiveAnalysis}
                    </div>
                    </div>
            `;
            
            // Update performance predictions
            const predictions = getPerformancePredictions(summary);
            document.getElementById('performance-predictions').innerHTML = `
                <div style="margin-bottom: 16px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 12px;">🚀 Performans Tahmini</h4>
                    <div style="background: #dcfce7; padding: 16px; border-radius: 8px; border-left: 4px solid #22c55e;">
                        ${predictions}
                    </div>
                    </div>
                `;
            
            // Update detailed insights
            const detailedInsights = getDetailedInsights(summary, lastTestResults);
            document.getElementById('detailed-insights-content').innerHTML = `
                <div style="background: #f8fafc; padding: 20px; border-radius: 8px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 16px;">📊 Detaylı Analiz Raporu</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--primary-color);">${summary.average_visibility_score}%</div>
                            <div style="font-size: 12px; color: var(--text-secondary); text-transform: uppercase;">Ortalama Skor</div>
                </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--primary-color);">${summary.mention_rate}%</div>
                            <div style="font-size: 12px; color: var(--text-secondary); text-transform: uppercase;">Mention Rate</div>
                        </div>
                        <div style="text-align: center; padding: 16px; background: white; border-radius: 8px;">
                            <div style="font-size: 24px; font-weight: 700; color: var(--primary-color);">${summary.mentioned_count}/${summary.successful_tests}</div>
                            <div style="font-size: 12px; color: var(--text-secondary); text-transform: uppercase;">Başarılı Testler</div>
                        </div>
                        </div>
                    <div style="border-top: 1px solid #e2e8f0; padding-top: 16px;">
                        <h5 style="margin-bottom: 12px; color: var(--text-primary);">Sentiment Analizi:</h5>
                        <div style="display: flex; gap: 16px; margin-bottom: 16px;">
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="color: #22c55e;">✅</span>
                                <span>Pozitif: ${summary.sentiment_breakdown.positive}</span>
                    </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="color: #f59e0b;">⚠️</span>
                                <span>Nötr: ${summary.sentiment_breakdown.neutral}</span>
                </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span style="color: #ef4444;">❌</span>
                                <span>Negatif: ${summary.sentiment_breakdown.negative}</span>
                        </div>
                            </div>
                            </div>
                    <div style="background: white; padding: 16px; border-radius: 8px; margin-top: 16px;">
                        <h5 style="margin-bottom: 12px; color: var(--text-primary);">Özet:</h5>
                        <p style="font-size: 14px; line-height: 1.6; color: var(--text-secondary);">${detailedInsights}</p>
                </div>
            </div>
        `;
    }
    
        // Helper functions for insights
        function getScoreColor(score) {
            if (score >= 70) return '#22c55e';
            if (score >= 40) return '#f59e0b';
            return '#ef4444';
        }

        function getTrendAnalysis(summary) {
            const score = summary.average_visibility_score;
            if (score >= 80) {
                return "Mükemmel performans! Siteniz AI modellerinde çok iyi tanınıyor. Bu seviyeyi korumak için içerik kalitesini sürdürün.";
            } else if (score >= 60) {
                return "İyi performans gösteriyorsunuz. Daha da iyileştirmek için SEO optimizasyonu ve içerik zenginleştirme yapabilirsiniz.";
            } else if (score >= 40) {
                return "Orta seviye performans. AI modellerinde daha iyi tanınmak için içerik stratejinizi gözden geçirin.";
            } else {
                return "Düşük performans. AI modellerinde tanınırlığınızı artırmak için kapsamlı bir dijital varlık stratejisi geliştirmeniz gerekiyor.";
            }
        }

        function getAIRecommendations(summary, website) {
            const recommendations = [];
            const score = summary.average_visibility_score;
            
            if (score < 50) {
                recommendations.push("Website içeriğinizi zenginleştirin ve daha fazla anahtar kelime kullanın");
                recommendations.push("Sosyal medya varlığınızı güçlendirin");
                recommendations.push("Backlink stratejinizi geliştirin");
                recommendations.push("İçerik kalitesini artırın ve düzenli güncellemeler yapın");
            } else if (score < 70) {
                recommendations.push("SEO optimizasyonunuzu iyileştirin");
                recommendations.push("İçerik çeşitliliğini artırın");
                recommendations.push("Kullanıcı deneyimini geliştirin");
            } else {
                recommendations.push("Mevcut performansınızı koruyun");
                recommendations.push("İçerik güncellemelerini düzenli yapın");
                recommendations.push("Rakip analizi yaparak farklılaşın");
            }
            
            return recommendations;
        }

        function getCompetitiveAnalysis(summary) {
            const bestPrompt = summary.best_performing_prompt;
            if (bestPrompt) {
                return `
                    <p style="margin-bottom: 8px; font-size: 14px;"><strong>En İyi Prompt:</strong> "${bestPrompt.prompt}"</p>
                    <p style="margin-bottom: 8px; font-size: 14px;"><strong>Sıralama:</strong> ${bestPrompt.ranking}. sırada</p>
                    <p style="margin-bottom: 8px; font-size: 14px;"><strong>Sentiment:</strong> ${bestPrompt.sentiment}</p>
                    <p style="font-size: 14px;">Bu prompt ile rak
                        </div>
                            </div>
                            </div>
                    <div style="background: white; padding: 16px; border-radius: 8px; margin-top: 16px;">
                        <h5 style="margin-bottom: 12px; color: var(--text-primary);">Özet:</h5>
                        <p style="font-size: 14px; line-height: 1.6; color: var(--text-secondary);">${detailedInsights}</p>
                </div>
            </div>
        `;
    }
    
        // Helper functions for insights
        function getScoreColor(score) {
            if (score >= 70) return '#22c55e';
            if (score >= 40) return '#f59e0b';
            return '#ef4444';
        }

        function getTrendAnalysis(summary) {
            const score = summary.average_visibility_score;
            if (score >= 80) {
                return "Mükemmel performans! Siteniz AI modellerinde çok iyi tanınıyor. Bu seviyeyi korumak için içerik kalitesini sürdürün.";
            } else if (score >= 60) {
                return "İyi performans gösteriyorsunuz. Daha da iyileştirmek için SEO optimizasyonu ve içerik zenginleştirme yapabilirsiniz.";
            } else if (score >= 40) {
                return "Orta seviye performans. AI modellerinde daha iyi tanınmak için içerik stratejinizi gözden geçirin.";
            } else {
                return "Düşük performans. AI modellerinde tanınırlığınızı artırmak için kapsamlı bir dijital varlık stratejisi geliştirmeniz gerekiyor.";
            }
        }

        function getAIRecommendations(summary, website) {
            const recommendations = [];
            const score = summary.average_visibility_score;
            
            if (score < 50) {
                recommendations.push("Website içeriğinizi zenginleştirin ve daha fazla anahtar kelime kullanın");
                recommendations.push("Sosyal medya varlığınızı güçlendirin");
                recommendations.push("Backlink stratejinizi geliştirin");
                recommendations.push("İçerik kalitesini artırın ve düzenli güncellemeler yapın");
            } else if (score < 70) {
                recommendations.push("SEO optimizasyonunuzu iyileştirin");
                recommendations.push("İçerik çeşitliliğini artırın");
                recommendations.push("Kullanıcı deneyimini geliştirin");
            } else {
                recommendations.push("Mevcut performansınızı koruyun");
                recommendations.push("İçerik güncellemelerini düzenli yapın");
                recommendations.push("Rakip analizi yaparak farklılaşın");
            }
            
            return recommendations;
        }

        function getCompetitiveAnalysis(summary) {
            const bestPrompt = summary.best_performing_prompt;
            if (bestPrompt) {
                return `
                    <p style="margin-bottom: 8px; font-size: 14px;"><strong>En İyi Prompt:</strong> "${bestPrompt.prompt}"</p>
                    <p style="margin-bottom: 8px; font-size: 14px;"><strong>Sıralama:</strong> ${bestPrompt.ranking}. sırada</p>
                    <p style="margin-bottom: 8px; font-size: 14px;"><strong>Sentiment:</strong> ${bestPrompt.sentiment}</p>
                    <p style="font-size: 14px;">Bu prompt ile rakipleriniz arasında ${bestPrompt.ranking}. sırada yer alıyorsunuz. Daha iyi sıralama için içerik stratejinizi bu prompt'a göre optimize edin.</p>
                `;
            }
            return "<p style='font-size: 14px;'>Henüz yeterli veri yok. Daha fazla test yaparak rakip analizi yapabilirsiniz.</p>";
        }

        function getPerformancePredictions(summary) {
            const score = summary.average_visibility_score;
            const mentionRate = summary.mention_rate;
            
            if (score >= 80 && mentionRate >= 80) {
                return "<p style='font-size: 14px;'>Mükemmel performans! Bu seviyeyi koruyarak AI modellerinde lider konumunuzu sürdürebilirsiniz.</p>";
            } else if (score >= 60 && mentionRate >= 60) {
                return "<p style='font-size: 14px;'>İyi performans gösteriyorsunuz. Önerilen iyileştirmeleri yaparak %80+ seviyeye çıkabilirsiniz.</p>";
            } else if (score >= 40 && mentionRate >= 40) {
                return "<p style='font-size: 14px;'>Orta seviye performans. Kapsamlı iyileştirmelerle 3-6 ay içinde %60+ seviyeye çıkabilirsiniz.</p>";
            } else {
                return "<p style='font-size: 14px;'>Düşük performans. Yoğun çalışma ile 6-12 ay içinde %50+ seviyeye çıkabilirsiniz.</p>";
            }
        }

        function getDetailedInsights(summary, testData) {
            const score = summary.average_visibility_score;
            const website = testData.website;
            
            if (score >= 80) {
                return `${website} sitesi AI modellerinde mükemmel bir tanınırlığa sahip. Yüksek mention rate ve pozitif sentiment ile rakipleriniz arasında öne çıkıyorsunuz. Bu performansı korumak için içerik kalitesini sürdürün ve düzenli güncellemeler yapın.`;
            } else if (score >= 60) {
                return `${website} sitesi AI modellerinde iyi bir tanınırlığa sahip. Mention rate'iniz kabul edilebilir seviyede ve sentiment analizi genellikle pozitif. Daha da iyileştirmek için SEO optimizasyonu ve içerik zenginleştirme çalışmaları yapabilirsiniz.`;
            } else if (score >= 40) {
                return `${website} sitesi AI modellerinde orta seviye bir tanınırlığa sahip. Mention rate'iniz geliştirilebilir ve sentiment analizi karışık sonuçlar gösteriyor. İçerik stratejinizi gözden geçirerek daha iyi sonuçlar elde edebilirsiniz.`;
        } else {
                return `${website} sitesi AI modellerinde düşük bir tanınırlığa sahip. Mention rate'iniz düşük ve sentiment analizi genellikle nötr veya negatif. Kapsamlı bir dijital varlık stratejisi geliştirerek bu durumu iyileştirebilirsiniz.`;
            }
        }

        // Chart initialization
        function initializeCharts() {
            const ctx = document.getElementById('visibilityChart').getContext('2d');
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jul 15', 'Jul 16', 'Jul 17', 'Jul 18', 'Jul 19', 'Jul 20', 'Jul 21'],
                    datasets: [{
                        label: 'Visibility %',
                        data: [15, 12, 14, 16, 18, 17, 17],
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            display: true,
                            beginAtZero: true,
                            max: 25
                        }
                    }
                }
            });
        }

        // Tag input functionality
        function setupTagInputs() {
            setupTagInput('brands', 'brands-tags');
            setupTagInput('models', 'models-tags');
            setupTagInput('websites', 'websites-tags');
        }

        function setupTagInput(inputId, tagsId) {
            const input = document.getElementById(inputId);
            const tagsContainer = document.getElementById(tagsId);
            
            // Check if elements exist before adding event listeners
            if (!input || !tagsContainer) {
                console.warn(`Tag input elements not found: ${inputId} or ${tagsId}`);
                return;
            }
            
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ',') {
                    e.preventDefault();
                    addTag(input.value.trim(), tagsContainer);
                    input.value = '';
                }
            });

            input.addEventListener('blur', function() {
                if (input.value.trim()) {
                    addTag(input.value.trim(), tagsContainer);
                    input.value = '';
                }
            });
        }

        function addTag(text, container) {
            if (!text) return;
            
            const tag = document.createElement('div');
            tag.className = 'tag';
            tag.innerHTML = `
                ${text} 
                <span class="remove" onclick="removeTag(this)">&times;</span>
            `;
            container.appendChild(tag);
        }

        function removeTag(element) {
            element.parentElement.remove();
        }

        function getTagValues(containerId) {
            const container = document.getElementById(containerId);
            const tags = container.querySelectorAll('.tag');
            return Array.from(tags).map(tag => tag.textContent.replace('×', '').trim());
        }

        // Form setup
        function setupForms() {
            // Add default values for any remaining forms if needed
        }

        // Analysis handlers - These are now handled by the REAL API Test
        // The old website and prompt analysis functions have been removed
        // as they are replaced by the new REAL API Test functionality

        // Real AI Test Functions
        function runRealVisibilityTest() {
            // Check if DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    openAITestModal();
                });
            } else {
                openAITestModal();
            }
}

// Real AI Test Modal Functions
function openAITestModal() {
            const modal = document.getElementById('aiTestModal');
            const websiteInput = document.getElementById('websiteInput');
            const customPrompt = document.getElementById('customPrompt');
            const testResults = document.getElementById('testResults');
            const testLoading = document.getElementById('testLoading');
            const testForm = document.getElementById('testForm');
            if (!modal || !websiteInput || !customPrompt || !testResults || !testLoading || !testForm) {
                console.error('Required DOM elements not found for AI Test Modal');
                return;
            }
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';
            websiteInput.value = '';
            customPrompt.value = '';
            testResults.style.display = 'none';
            testLoading.style.display = 'none';
            testForm.style.display = 'block';
}

function closeAITestModal() {
            const modal = document.getElementById('aiTestModal');
            if (modal) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
}

// Start Real AI Test (modal)
async function startRealAITest() {
        const websiteInput = document.getElementById('websiteInput');
        const customPrompt = document.getElementById('customPrompt');
        const testForm = document.getElementById('testForm');
        const testLoading = document.getElementById('testLoading');
        const testResults = document.getElementById('testResults');
        if (!websiteInput.value.trim()) {
            alert('❌ Lütfen website URL\'ini girin!');
            return;
        }
        if (!customPrompt.value.trim()) {
            alert('❌ Lütfen özel prompt\'u girin!');
            return;
        }
        testForm.style.display = 'none';
        testLoading.style.display = 'block';
        try {
            updateProgress && updateProgress(0, '🚀 Test başlatılıyor...');
            const requestData = {
                website: websiteInput.value.trim(),
                prompts: [customPrompt.value.trim()]
            };
            const response = await fetch(`${API_BASE}/run-real-visibility-test`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestData)
            });
            const result = await response.json();
            updateProgress && updateProgress(100, '✅ Test tamamlandı!');
            if (result.status === 'success') {
                const enhancedData = {
                    ...result.data,
                    custom_prompts: [customPrompt.value.trim()],
                    test_prompts: result.data.test_results ? result.data.test_results.map(r => r.prompt) : []
                };
                setTimeout(() => {
                    showAITestResults && showAITestResults(enhancedData);
                }, 1000);
            } else {
                throw new Error(result.message || 'Test hatası');
            }
        } catch (error) {
            console.error('AI Test Error:', error);
            testLoading.innerHTML = `
                <div class="loading-content">
                    <div style="color: #ef4444; font-size: 48px; margin-bottom: 16px;">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h4 style="color: #ef4444;">Test Hatası</h4>
                    <p>${error.message}</p>
                    <button class="btn btn-primary" onclick="openAITestModal()">
                        <i class="fas fa-redo"></i> Tekrar Dene
                    </button>
                </div>
            `;
        }
    }

    // Start Real AI Test (inline)
    function startRealAITestInline() {
        const websiteInput = document.getElementById('websiteInputInline');
        const customPrompt = document.getElementById('customPromptInline');
        const loading = document.getElementById('inlineTestLoading');
        const results = document.getElementById('inlineTestResults');
        const resultsContent = document.getElementById('inlineResultsContent');

        const website = websiteInput.value.trim();
        const prompt = customPrompt.value.trim();

        if (!website) {
            alert('Lütfen website URL\'ini girin!');
            return;
        }
        if (!prompt) {
            alert('Lütfen özel prompt\'u girin!');
            return;
        }

        loading.style.display = 'block';
        results.style.display = 'none';

        fetch(`${API_BASE}/run-real-visibility-test`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ website: website, prompts: [prompt] })
        })
        .then(res => res.json())
        .then(data => {
            loading.style.display = 'none';
            results.style.display = 'block';
            if (data.status === 'success') {
                const summary = data.data.summary;
                let html = `
                    <div class="result-card">
                        <div class="result-header">
                            <h3>🎯 ${data.data.website} - AI Visibility Raporu</h3>
                            <div class="result-stats">
                                <div class="stat-item">
                                    <span class="stat-value">${summary.average_visibility_score}%</span>
                                    <span class="stat-label">Visibility Score</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">${summary.mention_rate}%</span>
                                    <span class="stat-label">Mention Rate</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-value">${summary.mentioned_count}/${summary.successful_tests}</span>
                                    <span class="stat-label">Bahsedilme</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                resultsContent.innerHTML = html;
            } else {
                resultsContent.innerHTML = `<div style="color: #ef4444;">Test hatası: ${data.message || 'Bilinmeyen hata'}</div>`;
            }
        })
        .catch(err => {
            loading.style.display = 'none';
            results.style.display = 'block';
            resultsContent.innerHTML = `<div style="color: #ef4444;">Test hatası: ${err.message}</div>`;
        });
    }
    </script>
</body>
</html>